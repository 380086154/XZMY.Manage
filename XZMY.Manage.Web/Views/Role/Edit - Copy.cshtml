@model T2M.CoastLine.Server.Service.Auth.Models.ViewModel.VmRoleEdit
@{
    ViewBag.Title = "创建/编辑";
}
<div id="dashboard">
    <!-- BEGIN DASHBOARD STATS -->
    <div class="row-fluid">
        <div class="span10">
            <div class="tabbable tabbable-custom boxless">

                @*<ul class="nav nav-tabs">
                    <li class="active"><a href="#tab_1" data-toggle="tab">2 Columns</a></li>
                    <li><a class="" href="#tab_2" data-toggle="tab">2 Columns Horizontal</a></li>
                    <li><a href="#tab_3" data-toggle="tab">2 Columns View Only</a></li>
                    <li><a class="" href="#tab_4" data-toggle="tab">Row Seperated</a></li>
                    <li><a class="" href="#tab_5" data-toggle="tab">Bordered</a></li>
                    <li><a class="" href="#tab_6" data-toggle="tab">Bordered & Row Stripped</a></li>
                    <li><a class="" href="#tab_7" data-toggle="tab">Bordered & Label Stripped</a></li>
                </ul>*@

                <div class="tab-content">
                    <div class="tab-pane active" id="tab_1">
                        <div class="portlet box blue">
                            <div class="portlet-title">
                                <div class="caption">
                                    <i class="icon-reorder"></i>角色信息
                                </div>

                                <div class="tools">
                                    <a href="javascript:void(0);" class="collapse"></a>

                                    @*<a href="#portlet-config" data-toggle="modal" class="config"></a>
                                    <a href="javascript:;" class="reload"></a>
                                    <a href="javascript:;" class="remove"></a>*@
                                </div>
                            </div>

                            <div class="portlet-body form">

                                <!-- BEGIN FORM-->

                                <form id="defaultForm" class="form-horizontal" method="post" novalidate="novalidate">
                                    @*<h3 class="form-section">角色信息</h3>*@

                                    <div class="alert alert-error hide">
                                        <button class="close" data-dismiss="alert"></button>
                                        你有一些错误，请检查。
                                    </div>

                                    <div class="alert alert-success hide">
                                        <button class="close" data-dismiss="alert"></button>
                                        Your form validation is successful!
                                    </div>

                                    <div class="row-fluid">
          
                                    </div>

                                    <!--/row-->

                                    <div class="row-fluid">
                                        <div class="span6 ">
                                            <div class="control-group">
                                                <label class="control-label" for="Name">名称<span class="required">*</span></label>
                                                <div class="controls">
                                                    @Html.TextBoxFor(x => x.Name, new { @maxlength = "50", @class = "m-wrap span10" })
                                                    @Html.HiddenFor(x => x.Id)
                                                </div>
                                            </div>
                                        </div>

                                        <div class="span6 ">
                                            <div class="control-group">
                                                <label class="control-label">状态</label>
                                                <div class="controls">
                                                    <label class="radio">
                                                        <input type="radio" name="State" value="1" checked="checked" />
                                                        启用
                                                    </label>
                                                    <label class="radio">
                                                        <input type="radio" name="State" value="2" />
                                                        禁用
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row-fluid">
                                        <div class="span10 ">
                                            <div class="control-group">
                                                <label class="control-label" for="Description">描述</label>
                                                <div class="controls">
                                                    @Html.TextBoxFor(x => x.Description, new { @maxlength = "500", @class = "m-wrap span10" })
                                                </div>
                                            </div>
                                        </div>
                                        <!--/span-->
                                        <div class="span6 ">
                                            <div class="control-group error">

                                            </div>
                                        </div>
                                        <!--/span-->
                                    </div>
                                    
                                    <!--/row-->
                                    
                                    <div class="form-actions">
                                        <button type="submit" class="btn blue"><i class="icon-ok"></i> 保存</button>
                                        <button type="reset" class="btn">重置</button>
                                    </div>

                                </form>
                                <!-- END FORM-->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- END DASHBOARD STATS -->
    <div class="clearfix"></div>
</div>

<script type="text/javascript">
    jQuery(document).ready(function () {
        var form1 = $('#defaultForm');
        var hfId = $('#Id');
        var error1 = $('.alert-error', form1);
        var success1 = $('.alert-success', form1);
        var isRequired = hfId.val() == '00000000-0000-0000-0000-000000000000';
        
        $("input[name='State'][value=@Model.State]").attr("checked", true);

        form1.validate({
            errorElement: 'span', //default input error message container
            errorClass: 'help-inline', // default input error message class
            focusInvalid: false, // do not focus the last invalid input
            ignore: "",
            rules: {
                Name: { required: true, remote: { url: '/Role/AjaxIsExist/@Model.Id', message: '已存在' } },
            },

            invalidHandler: function (event, validator) { //display error alert on form submit              
                success1.hide();
                error1.show();
                App.scrollTo(error1, -200);
            },

            highlight: function (element) { // hightlight error inputs
                $(element).closest('.help-inline').removeClass('ok'); // display OK icon
                $(element).closest('.control-group').removeClass('success').addClass('error'); // set error class to the control group
            },

            unhighlight: function (element) { // revert the change dony by hightlight
                $(element).closest('.control-group').removeClass('error'); // set error class to the control group
            },

            success: function (label) {
                label.addClass('valid').addClass('help-inline ok') // mark the current input as valid and display OK icon
                .closest('.control-group').removeClass('error').addClass('success'); // set success class to the control group
            },

            submitHandler: function (form) {                
                //success1.show();
                //error1.hide();
                //form1.submit();

                var data = form1.serializeObject();
                $.ajax({
                    type: 'POST',
                    url: '/Role/AjaxEdit',
                    data: data,
                    dataType: 'JSON',
                    success: function (result) {
                        if (result.success)
                            location.replace('/Role/details/' + result.Id);
                        else {
                            
                        }
                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        alert(JSON.stringify(errorThrown));
                    },
                    async: false
                });
            }
        });
    });
</script>
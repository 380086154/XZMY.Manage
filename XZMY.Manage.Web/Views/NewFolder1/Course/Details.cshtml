@model XZMY.Manage.Model.ViewModel.Courses.VmCourseEdit
@{
    Layout = "~/Views/Shared/_Layout456.cshtml";
    ViewBag.Title = "创建/编辑";
}
<link href="/UploadCode/css/smart-green.css" rel="stylesheet" />
<link href="/UploadCode/webuploader/webuploader.css" rel="stylesheet" type="text/css" />
<script src="/UploadCode/webuploader/webuploader.min.js" type="text/javascript"></script>
<script src="/UploadCode/js/uploader.js" type="text/javascript" charset="utf-8"></script>
<!-- BEGIN PAGE BAR -->
<div class="page-bar">
    <ul class="page-breadcrumb">
        <li>
            <a href="/home/index">主页</a>
            <i class="fa fa-angle-right"></i>
        </li>
        <li>
            <span id="module">课程中心</span>
            <i class="fa fa-angle-right"></i>
        </li>
        <li>
            <span id="action">课程详细</span>
        </li>
    </ul>
</div>
<!-- END PAGE BAR -->
<div class="row" style="margin-top: 20px">
    <div class="col-md-12">
        <!-- BEGIN VALIDATION STATES-->
        <div class="portlet light bordered" id="form_wizard_1">
            <div class="portlet-title">
                <div class="caption">
                    <span style="font-size: 25px;color: #000">基础信息</span>
                </div>
                <div class="actions">
                    @if (Model.DataId != Guid.Empty)
                    {
                        <a class="btn btn-default" href="/Course/Edit/@Model.DataId">
                            <i class="fa fa-pencil"></i> 编辑
                        </a>
                    }
                    <a class="btn btn-default" href="/Course/List">
                        <i class="fa fa-list-ul"></i> 返回列表
                    </a>
                </div>
            </div>
            <div class="portlet-body form">
                <!-- BEGIN FORM-->
                <form id="defaultForm" class="form-horizontal" method="post" novalidate="novalidate">
                    <div class="form-body">
                        @*<h3 class="form-section">课程模板基础信息</h3>*@

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="control-label col-md-3">课程名称：</label>
                                    <div class="col-md-9">
                                        <div class="input-icon right">
                                            <i class="fa"></i>
                                            <p class="form-control-static"> @Model.Name </p>
                                            @Html.HiddenFor(x => x.DataId)
                                            @Html.HiddenFor(x => x.CourseTemplateId)
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="control-label col-md-3">课程编码：</label>
                                    <div class="col-md-9">
                                        <div class="input-icon right">
                                            <i class="fa"></i>
                                            <p class="form-control-static"> @Model.Code </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="control-label col-md-3">宣传图片：</label>
                                    <div class="col-md-9">
                                        <div class="input-icon right">
                                            @*批量上传图片按钮*@
                                            <div id="btnalbum" style="float: left;" class="upload-box upload-album"></div>
                                            @*<input type="text" id="firstName" class="form-control" placeholder="Chee Kin">*@
                                            @Html.HiddenFor(x => x.Pictures)
                                            <div class="photo-list" style="float: left; width: 100%;">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="control-label col-md-3">课程类型：</label>
                                    <div class="col-md-9">
                                        <div class="input-icon right">
                                            <p class="form-control-static"> @Model.CourseTypeName </p>
                                            @Html.HiddenFor(x => x.CourseTypeId)
                                            @Html.HiddenFor(x => x.CourseTypeName)
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="control-label col-md-3">课程地点：</label>
                                    <div class="col-md-9">
                                        <div class="input-icon right">
                                            <p class="form-control-static"> @Model.CoursePlaceName </p>
                                            @Html.HiddenFor(x => x.CoursePlaceLocationId)
                                            @Html.HiddenFor(x => x.CoursePlaceName)
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="control-label col-md-3">主办方：</label>
                                    <div class="col-md-9">
                                        <div class="input-icon right">
                                            <i class="fa"></i>
                                            <p class="form-control-static"> @Model.Sponsor </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="control-label col-md-3">推荐指数：</label>
                                    <div class="col-md-9">
                                        <div class="input-icon right">
                                            <i class="fa"></i>
                                            <p class="form-control-static"> @Model.RecommendedIndex </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="control-label col-md-3">面向人群：</label>
                                    <div class="col-md-9">
                                        <div class="input-icon right">
                                            @Html.HiddenFor(x => x.SuitablePerson)
                                            <p class="form-control-static"> @Model.SuitablePersonName </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="control-label col-md-3">包含服务：</label>
                                    <div class="col-md-9">
                                        <div class="input-icon right">
                                            @Html.HiddenFor(x => x.Service)
                                            <p class="form-control-static"> @Model.Service </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--2016-9-23新增字段-->
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="control-label col-md-3">热点标识：</label>
                                    <div class="col-md-9">
                                        <div class="input-icon right">
                                            <i class="fa"></i>
                                            <p class="form-control-static"> @Model.HotKey </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="control-label col-md-3">学术指数：</label>
                                    <div class="col-md-9">
                                        <div class="input-icon right">

                                            <i class="fa"></i>
                                            <p class="form-control-static">@Model.LearnUp</p>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="control-label col-md-3">英语指数：</label>
                                    <div class="col-md-9">
                                        <div class="input-icon right">
                                            <i class="fa"></i>
                                            <p class="form-control-static"> @Model.EnglishUp </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="control-label col-md-3">能力指数：</label>
                                    <div class="col-md-9">
                                        <div class="input-icon right">

                                            <i class="fa"></i>
                                            <p class="form-control-static">@Model.AbilityUp</p>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--End 2016-9-23新增字段-->
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="control-label col-md-3">推荐理由：</label>
                                    <div class="col-md-9">
                                        <div class="input-icon right">
                                            <p class="form-control-static"> @Html.Raw(Model.RecommendedReason.Replace(",", "　")) </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <h3 class="form-section">课程时间</h3>

                        <div id="dateItem" style="display: none">

                            <div class="row item-date">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="control-label col-md-3">时间__INDEX__：</label>
                                        <div class="col-md-9">
                                            <div class="input-icon right">
                                                <i class="fa"></i>
                                                <div class="input-group input-large date-picker input-daterange" style="width: 120%" data-date="2016-07-19" data-date-format="yyyy-mm-dd">
                                                    <p class="form-control-static"> __BEGINDATE__ </p>
                                                    @*<input type="text" class="form-control" name="BeginDate" value="__BEGINDATE__">
                                                    <span class="input-group-addon"> 到 </span>*@
                                                    　到　
                                                    @*<input type="text" class="form-control" name="EndDate" value="__ENDDATE__">*@
                                                    <p class="form-control-static"> __ENDDATE__ </p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="control-label col-md-3"></label>
                                        <div class="col-md-9">
                                            <div class="input-icon right">
                                                <input name="CourseTimeId" type="hidden" value="__COURSETIMEID__" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="divTimeDepartureCity">

                        </div>
                        <input type="hidden" id="hfDateList" name="dateList" value="" />

                        <h3 class="form-section">课程价格</h3>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="control-label col-md-3">市场价格：</label>
                                    <div class="col-md-9">
                                        <div class="input-icon right">
                                            <i class="fa"></i>
                                            <p class="form-control-static"> @Model.MarketPrice.ToString("N2") </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="control-label col-md-3">课程价格：</label>
                                    <div class="col-md-9">
                                        <div class="input-icon right">
                                            <i class="fa"></i>
                                            <p class="form-control-static"> @Model.ActualPrice.ToString("N2") </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="control-label col-md-3">折扣：</label>
                                    <div class="col-md-9">
                                        <div class="input-icon right">
                                            <i class="fa"></i>
                                            <p class="form-control-static"> @Model.Discount.ToString("N2") </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="control-label col-md-3">定金：</label>
                                    <div class="col-md-9">
                                        <div class="input-icon right">
                                            <i class="fa"></i>
                                            <p class="form-control-static"> @Model.DepositPrice.ToString("N2") </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <h3 class="form-section">课程分值</h3>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="control-label col-md-3">难度指数：</label>
                                    <div class="col-md-9">
                                        <div class="input-icon right">
                                            <p class="form-control-static"> @Model.DifficultyValue </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6" style="display:none;">
                                <div class="form-group">
                                    <label class="control-label col-md-3">完成率：</label>
                                    <div class="col-md-9">
                                        <div class="input-icon right">
                                            <p class="form-control-static"> @Model.CompletionValue </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="control-label col-md-3">性价比：</label>
                                    <div class="col-md-9">
                                        <div class="input-icon right">
                                            <p class="form-control-static"> @Model.FeeValue </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <h3 class="form-section">成长分值</h3>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="control-label col-md-3">英语加分：</label>
                                    <div class="col-md-9">
                                        <div class="input-icon right">
                                            <p class="form-control-static"> @Model.EnglishScore.ToString("N2") </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="control-label col-md-3">学科加分：</label>
                                    <div class="col-md-9">
                                        <div class="input-icon right">
                                            <p class="form-control-static"> @Model.LearnScore.ToString("N2") </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="control-label col-md-3">素质加分：</label>
                                    <div class="col-md-9">
                                        <div class="input-icon right">
                                            <p class="form-control-static"> @Model.QualityScore.ToString("N2") </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <h3 class="form-section">历练项目</h3>

                        <div id="divScoreItems">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="control-label col-md-3">主要成长：</label>
                                        <div class="col-md-9">
                                            <div class="input-icon right">
                                                <div id="divScoreItemNames" class="controls mt-radio-inline" style="width: 100%;">
                                                    <p class="form-control-static"> @Model.ScoreItemNames </p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <h3 class="form-section">课程介绍</h3>

                    <div class="tab-pane active" id="tab_4">
                        <div class="portlet box blue">
                            <div class="portlet-body form">
                                <div class="row-fluid">
                                    <div class="span11 ">
                                        <div class="control-group">
                                            <div class="controls">
                                                <ul class="nav nav-tabs">
                                                    <li class="active"><a href="#tab_1_1" data-toggle="tab">项目介绍</a></li>
                                                    <li><a href="#tab_1_2" data-toggle="tab">行程安排</a></li>
                                                    <li><a href="#tab_1_3" data-toggle="tab">费用说明</a></li>
                                                    <li><a href="#tab_1_4" data-toggle="tab">住宿安排</a></li>
                                                    <li><a href="#tab_1_5" data-toggle="tab">签证说明</a></li>
                                                    <li><a href="#tab_1_6" data-toggle="tab">行程须知</a></li>
                                                    <li><a href="#tab_1_7" data-toggle="tab">安全保障</a></li>
                                                </ul>
                                                <div class="tab-content">
                                                    <div class="tab-pane active" id="tab_1_1">
                                                        <p class="form-control-static">@Html.Raw(Model.CourseDescription)</p>
                                                    </div>
                                                    <div class="tab-pane" id="tab_1_2">
                                                        <p class="form-control-static">@Html.Raw(Model.Schedule)</p>
                                                    </div>
                                                    <div class="tab-pane" id="tab_1_3">
                                                        <p class="form-control-static">@Html.Raw(Model.Fee)</p>
                                                    </div>
                                                    <div class="tab-pane" id="tab_1_4">
                                                        <p class="form-control-static">@Html.Raw(Model.Stay)</p>
                                                    </div>
                                                    <div class="tab-pane" id="tab_1_5">
                                                        <p class="form-control-static">@Html.Raw(Model.Visa)</p>
                                                    </div>
                                                    <div class="tab-pane" id="tab_1_6">
                                                        <p class="form-control-static">@Html.Raw(Model.Stroke)</p>
                                                    </div>
                                                    <div class="tab-pane" id="tab_1_7">
                                                        <p class="form-control-static">@Html.Raw(Model.Security)</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
                <!-- END FORM-->
            </div>
        </div>
        <!-- END VALIDATION STATES-->
    </div>
</div>
@section JavaScript{
    <script src="/UploadCode/webuploader/webuploader.min.js" type="text/javascript"></script>
    <script src="/UploadCode/js/uploader.js" type="text/javascript" charset="utf-8"></script>
    <script type="text/javascript">

        $(function () {
            //页面加载绑定各种下拉列表框
            LoadPage();

        });
        function LoadPage() {
            LoadDllScore();
            //加载课程图片
            ShowImageList();
            //加载地区
            //GetCountry($("#CoursePlaceName").val());
            //加载课程时间选择框
            LoadDepartureCity();
        }
        //页面加载绑定课程分值
        function LoadDllScore() {
            //修改
            $.getJSON("/Scores/AjaxList", { SourceId: $("#Id").val() },
               function (data) {
                   $.each(data.rows, function(i, item) {
                       var divname = [];
                       //+ '     <div class="row-fluid">                                                                                       '
                       //+ '          <div class="span6 ">                                                                                     '
                       //+ '              <div class="control-group">                                                                          '
                       //+ '                  <label class="control-label" for="RealName">' + item["ScoreItemsName"] + '：</label>      '
                       //+ '                  <div class="controls">                                                                           '
                       //+ '                        <span class="text display-value">' + item["ScoreValue"] + '</span>'
                       //+ '                  </div>                                                                                           '
                       //+ '              </div>                                                                                               '
                       //+ '          </div>                                                                                                   '
                       //+ '      </div>                                                                                                       '


                       //var flag = i % 2 == 0;
                       //console.log(i + ' - ' + flag);
                       //if (flag ) {
                       divname.push('            <div class="row" style="display: none">');
                       //}
                       divname.push('                <div class="col-md-6">');
                       divname.push('                    <div class="form-group">');
                       divname.push('                        <label class="control-label col-md-3" >' + item["ScoreItemsName"] + '：</label>');
                       divname.push('                        <div class="col-md-9">');
                       divname.push('                            <div class="input-icon right">');
                       divname.push('                                <div class="controls mt-radio-inline" style="width: 100%;">');
                       divname.push('                                     <p class="form-control-static"> ' + item["ScoreValue"] + ' </p>         ');
                       divname.push('                                </div>');
                       divname.push('                            </div>');
                       divname.push('                        </div>');
                       divname.push('                    </div>');
                       divname.push('                </div>');

                       //if (!flag) {
                       divname.push('            </div>');
                       //}


                       $(divname.join('')).appendTo($("#divScoreItems"));
                   });
               });
        }

        //显示图片
        function ShowImageList() {
            if ($("#Pictures").val() != "") {
                var ImageUrls = $("#Pictures").val().split(",");
                var photolistHtml = '';
                for (var i = 0; i < ImageUrls.length; i++) {
                    /* ShowImage(imgSrc, Url, IsShowDel, IsShowUrl)方法说明
                    imgSrc:图片地址
                    Url:图片跳转链接
                    IsShowDel:是否显示删除按钮
                    IsShowUrl:是否显示跳转链接的文本框
                    */
                    photolistHtml = ShowImage(ImageUrls[i], '', false, false);
                    $(photolistHtml).appendTo(".photo-list");
                }
            }
        }
        function LoadDepartureCity() {
            if ($("#Id").val() != "00000000-0000-0000-0000-000000000000") {
                $.getJSON("/CourseDate/AjaxList", { CourseId: $("#Id").val() },
                   function (data) {
                       $.each(data.rows, function(i, item) {
                           //课程时主键ID，课程开始时间，课程结束时间，课程出发城市
                           AddDivDepartureCity(item["Id"].toString(), yyyy_mm_dd(item["BeginDate"]), yyyy_mm_dd(item["EndDate"]), item["DepartureCity"].toString(), i);
                       });
                   });
            }
        }
        //添加一个课程时间选择框
        function AddDivDepartureCity(CourseTimeId, SelectTime1, SelectTime2, CityName, i) {
            //var strHtml = '' + SelectTime1 + '~' + SelectTime2 + '<br/>';

            var strHtml = $('#dateItem').html()
                .replace(/__INDEX__/ig, i + 1)
                .replace(/__BEGINDATE__/ig, SelectTime1)
                .replace(/__ENDDATE__/ig, SelectTime2);
            
            //$("#divTimeDepartureCity").html(strHtml);
            $(strHtml).appendTo($("#divTimeDepartureCity"));
        }
        function ChangeDateFormat(cellval) {
            return cellval.split('T')[0];

            var date = new Date(parseInt(cellval.replace("/Date(", "").replace(")/", ""), 10));
            var month = date.getMonth() + 1 < 10 ? "0" + (date.getMonth() + 1) : date.getMonth() + 1;
            var currentDate = date.getDate() < 10 ? "0" + date.getDate() : date.getDate();
            return date.getFullYear() + "-" + month + "-" + currentDate;
        }
    </script>
}
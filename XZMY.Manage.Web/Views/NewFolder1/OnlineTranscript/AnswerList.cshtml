@model XZMY.Manage.Model.ViewModel.OnlineAssessment.VmOnlineAssessmentQuestions
@using XZMY.Manage.Model.ViewModel.OnlineAssessment
@{
    ViewBag.Title = "AnswerList";
    Layout = "~/Views/Shared/_Layout456.cshtml";
}
@section Style{
    <link href="~/Content/Metronic4.5.6/global/css/components.min.css" rel="stylesheet" id="style_components" type="text/css" />
    <link href="~/Content/Metronic4.5.6/pages/css/portfolio.min.css" rel="stylesheet" type="text/css" />
    <style>
        #rC_D {
            background: #3498db;
            border: 1px solid rgba(0,0,0,0);
        }

        .item-img {
            float: left;
            margin-left: 10px;
            margin-right: 10px;
            margin-bottom: 10px;
        }

            .item-img.selected {
                border: 4px solid red;
            }

        .radio.answer-bottom {
            margin-bottom: 20px;
        }
    </style>
}
<!-- BEGIN PAGE BAR -->
<div class="page-bar">
    <ul class="page-breadcrumb">
        <li>
            <a href="/home/index">主页</a>
            <i class="fa fa-angle-right"></i>
        </li>
        <li>
            <span id="module">在线评估</span>
            <i class="fa fa-angle-right"></i>
        </li>
        <li>
            <span id="action">查看答题列表</span>
        </li>
    </ul>
</div>
<div class="mt-bootstrap-tables" style="margin-top:20px">
    <div class="row">
        <div class="col-md-12">
            <div class="portlet light bordered">
                <div class="portlet-title">
                    <div class="caption">
                        <i class="icon-social-dribbble font-green hide"></i>
                        <span style="font-size: 25px;color: #000">基本信息</span>
                    </div>
                    <div class="actions">
                        <a class="btn btn-default" href="/OnlineTranscript/List">
                            <i class="fa fa-list-ul"></i> 返回列表
                        </a>

                    </div>

                </div>
                <div class="portlet-body form">
                    <form id="defaultForm" class="form-horizontal" method="post" novalidate="novalidate">
                        <div class="form-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="control-label col-md-3">试卷：</label>
                                        <div class="col-md-9">
                                            <div class="input-icon right">
                                                <span class="form-control-static" style="font-weight:bold">@ViewBag.SecurityName</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="control-label col-md-3">答题耗时：</label>
                                        <div class="col-md-9">
                                            <div class="input-icon right">
                                                <span class="form-control-static">@ViewBag.UsedTime</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="control-label col-md-3">学生名：</label>
                                        <div class="col-md-9">
                                            <div class="input-icon right">
                                                <span class="form-control-static">@ViewBag.StudentName</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="control-label col-md-3">答题时间：</label>
                                        <div class="col-md-9">
                                            <div class="input-icon right">
                                                <span class="form-control-static">@ViewBag.SeTime</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </form>



                </div>

            </div>
        </div>
    </div>
</div>
<!-- END PAGE BAR -->
<div class="mt-bootstrap-tables" style="margin-top:20px">
    <div class="row">
        <div class="col-md-12">
            <div class="portlet light bordered">


                <div class="portlet-body">

                    <input id="hidd-indexPage" type="hidden" value="@ViewBag.IndexPage" />
                    <input id="hidd-TranscriptId" type="hidden" value="@ViewBag.TranscriptId" />
                    <input id="hidd-QuestionId" type="hidden" value="@ViewBag.QuestionId" />
                    <input id="hidd-QuestionAllCount" type="hidden" value="@ViewBag.QuestionAllCount" />
                    
                    

                    <div class="page-bar" style="background:#4b77be;">
                        <div style="padding:3px; float:left; width:33%; margin-top:5px;">
                            <button id="btn-up" type="button" class="btn btn-default mt-ladda-btn ladda-button btn-circle blue-steel" data-style="expand-left">
                                <span class="ladda-label">
                                    <i class="icon-arrow-left"></i> 上一题
                                </span>
                            </button>

                        </div>

                        <div style="padding:3px; float:left; width:33%;  margin-top:5px;">
                            <button id="btn-down" type="button" class="btn btn-primary mt-ladda-btn ladda-button btn-circle blue-steel" data-style="expand-right">
                                <span class="ladda-label">
                                    <i class="icon-arrow-right"></i> 下一题
                                </span>
                            </button>

                        </div>
                        <div style="padding:5px 3px 3px 3px; float:left; width:33%;  text-align:center; color:#fff; height:38px; line-height:38px; vertical-align:middle">

                            <div class="btn-toolbar margin-bottom-10" style="margin-right:50px; float:right;">
                                <div class="btn-group btn-group-circle" style="height:38px;">
                                    <label id="lab-RCount" style="margin-right:20px;">@ViewBag.IndexPage / @ViewBag.QuestionAllCount</label>
                                </div>
                                <div class="btn-group btn-group-circle">

                                    <input id="input-go" class="form-control" maxlength="4" style="width:60px; float:left; border-right-width:0;" value="@ViewBag.IndexPage" type="text" />
                                    <button id="btn-go" type="button" class="btn btn-default" style="background-color:#fff; color:#3598dc;">Go</button>
                                    <label></label>
                                </div>
                            </div>


                        </div>

                    </div>
                    <div>

                        <div class="portlet light portlet-fit full-height-content full-height-content-scrollable bordered">

                            <div class="portlet-body">
                                <div class="full-height-content-body">
                                    <h3>@Model.Title</h3>
                                    @Html.Raw(Model.Description)
                                </div>
                                <div class="row">
                                    <div class="col-lg-12 col-md-12 col-xs-12">
                                        <div class="mt-element-ribbon bg-grey-steel" style="min-height:200px;">
                                            <div class="ribbon ribbon-color-primary uppercase">答案选择</div>
                                            <input id="hidd-AnswerType" type="hidden" value="@((int)Model.Type)" />
                                            @{  List<VmOnlineAssessmentAnswers> answerList = ViewBag.AnswerList as List<VmOnlineAssessmentAnswers>;}
                                            @if (Model.Type == XZMY.Manage.Model.Enum.EOnlineAssessmentQuestionType.分组单选题)
                                            {
                                                List<VmOnlineAssessmentAnswersGroup> answerGroupList = ViewBag.QuestionGroupList as List<VmOnlineAssessmentAnswersGroup>;
                                                <div id="answer-groupRadio" style="margin-top:3em;">

                                                    <table class="table table-striped">
                                                        <thead>
                                                            <tr>
                                                                <td></td>
                                                                <td></td>
                                                                @foreach (var item in  answerGroupList)
                                                                {
                                                                    <td >@item.GroupName</td>
                                                                }
                                                            </tr>
                                                        </thead>

                                                        @for (int i = 0; i < answerList.Count; i++)
                                                        {
                                                            <tr id="index-@i">
                                                                <td>@(i + 1)</td>
                                                                <td>
                                                                    @answerList[i].Description

                                                                </td>
                                                                @for (int j = 0; j < answerGroupList.Count; j++)
                                                                {
                                                                    <td>
                                                                        <label>
                                                                            <input type="radio" name="options-@i" value="@(answerList[i].Id.ToString()+","+answerGroupList[j].Id.ToString())" data_TrId="index-@i" disabled="disabled">
                                                                        </label>

                                                                    </td>
                                                                }

                                                            </tr>
                                                        }


                                                    </table>
                                                </div>
                                            }
                                            else if (Model.Type == XZMY.Manage.Model.Enum.EOnlineAssessmentQuestionType.图片单选题)
                                            {
                                                <div id="answer-textImg" style="margin-top:3em;">
                                                    @foreach (var item in answerList)
                                                    {
                                                        <div class="cbp-caption-defaultWrap item-img" data_textImg="@item.Id">
                                                            <img src="@item.Picture" style="width:220px; height:220px;" alt="">
                                                            <div style="width:100%; text-align:center; margin-top:5px;">@item.Description</div>
                                                            <input class="hidd-textImgItem" type="hidden" value="@item.Id" />
                                                        </div>
                                                    }
                                                    <div style="clear:both;"></div>
                                                </div>
                                            }
                                            else
                                            {
                                                <div id="answer-textRadio" style="margin-top:3em;">
                                                    @foreach (var item in answerList)
                                                    {
                                                        <div class="radio answer-bottom">
                                                            <label>
                                                                <input type="radio" name="options-@item.Id"  value="@item.Id" disabled="disabled">
                                                                @item.Description
                                                            </label>
                                                        </div>
                                                    }
                                                </div>
                                            }



                                        </div>
                                    </div>

                                </div>


                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>


@section JavaScript{
    <script src="~/Content/Metronic4.5.6/global/plugins/cubeportfolio/js/jquery.cubeportfolio.min.js" type="text/javascript"></script>
    <script src="~/Content/Metronic4.5.6/pages/scripts/portfolio-1.min.js" type="text/javascript"></script>
    <script>
        $(function () {
           
            var _transcriptId = $("#hidd-TranscriptId").val();
            var indexVal = $("#hidd-indexPage").val();
            indexVal = (indexVal == "" || isNaN(indexVal)) ? "1" : indexVal;
            var _questionAllCount = $("#hidd-QuestionAllCount").val();
            
            var questionAllCount = parseInt(_questionAllCount);
            var indexPage = parseInt(indexVal);
            
            $("#btn-up").click(function () {
                
                if (indexPage > 1) {
                    location.href = "/OnlineTranscript/AnswerList/" + _transcriptId + "?index=" + (indexPage - 1);
                }

            });
            $("#btn-down").click(function () {
                
                if (indexPage >= 1 && indexPage < questionAllCount)
                {
                    location.href = "/OnlineTranscript/AnswerList/" + _transcriptId + "?index=" + (indexPage + 1);
                }
            });
            $("#btn-go").click(function () {
                var indexPage = $("#input-go").val(); 
                if (!isNaN(indexPage)) {
                    indexPage = parseInt(indexPage);
                    indexPage = Math.abs(indexPage);
                    indexPage = (indexPage == 0 || indexPage > questionAllCount) ? 1 : indexPage;
                    $("#input-go").val(indexPage);
                    location.href = "/OnlineTranscript/AnswerList/" + _transcriptId + "?index=" + indexPage;
                }
                
            });
        });
        var loadUserAnswerBind = function () {

            $.ajax({
                url: "/OnlineTranscript/AjaxLoadUserAnswer",
                data: { transcriptId: $("#hidd-TranscriptId").val(), questionId: $("#hidd-QuestionId").val() },
                dataType: "json",
                success: function (data) {
                    if (data.total > 0) {
                        var typeVal = parseInt($("#hidd-AnswerType").val());
                        if (typeVal == 2) {//图片单选题
                            $(".item-img", $("#answer-textImg")).each(function () {
                                var theImgDiv = $(this)
                                var _val = $(".hidd-textImgItem", theImgDiv).val().toLowerCase();
                                $.each(data.rows, function (i, item) {
                                    if (item.OnlineAssessmentAnswersId.toLowerCase() == _val)
                                        theImgDiv.addClass("selected");
                                });
                            });
                        }
                        else if (typeVal == 3) {//分组单选题
                            $("input:radio", $("#answer-groupRadio")).each(function () {
                                var theRadio = $(this);
                                $.each(data.rows, function (i, item) {
                                    var valueGroup = item.OnlineAssessmentAnswersId.toLowerCase() + "," + item.OnlineAssessmentAnswersGroupId.toLowerCase();
                                    if (valueGroup == theRadio.val().toLowerCase())
                                        theRadio.prop("checked", true);
                                });
                            });
                        }
                        else //文字单选题
                        {
                            $("input:radio", $("#answer-textRadio")).each(function () {
                                var theRadio = $(this);
                                $.each(data.rows, function (i, item) {
                                    if (item.OnlineAssessmentAnswersId.toLowerCase() == theRadio.val().toLowerCase())
                                        theRadio.prop("checked", true);
                                });
                            });
                        }
                    }
                },
                error: function (e) {
                    
                    //alert("XXXX" + );
                }
                
            });


            
        }
        loadUserAnswerBind();

    </script>
}

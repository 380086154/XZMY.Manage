@using XZMY.Manage.Web.Controllers.Program
@using XZMY.Manage.Web.Controllers.SiteSetting
@model XZMY.Manage.Model.ViewModel.Project.VmProjectTemplate
@{
    Layout = "~/Views/Shared/_Layout456.cshtml";
    ViewBag.Title = "活动模板创建/编辑";
}
@section Style{
    <link href="/UploadCode/css/smart-green.css" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="/UploadCode/webuploader/webuploader.css" />
}
<!-- BEGIN PAGE BAR -->
<div class="page-bar">
    <ul class="page-breadcrumb">
        <li>
            <a href="/home/index">主页</a>
            <i class="fa fa-angle-right"></i>
        </li>
        <li>
            <span id="module">活动中心</span>
            <i class="fa fa-angle-right"></i>
        </li>
        <li>
            <span id="action">编辑活动模版</span>
        </li>
    </ul>
</div>
<!-- END PAGE BAR -->
<div class="row" style="margin-top: 20px">
    <div class="col-md-12">
        <!-- BEGIN VALIDATION STATES-->
        <div class="portlet light bordered" id="form_wizard_1">
            <div class="portlet-title">
                <div class="caption">
                    <span style="font-size: 25px;color: #000">基础信息</span>
                </div>
                <div class="actions">
                    @*@if (Model.DataId != Guid.Empty)
                    {
                        <a class="btn btn-default" href="/ProjectTemplate/Details/@Model.DataId">
                            <i class="fa fa-pencil"></i> 详细
                        </a>
                    }*@
                    <a class="btn btn-default" href="/ProjectTemplate/Edit/">
                        <i class="fa fa-pencil"></i> 创建活动模板
                    </a>
                    <a class="btn btn-default" href="/ProjectTemplate/List">
                        <i class="fa fa-list-ul"></i> 返回列表
                    </a>
                </div>
            </div>
            <div class="portlet-body form">
                <!-- BEGIN FORM-->
                <form id="defaultForm" class="form-horizontal" method="post" novalidate="novalidate">
                    <div class="form-body">
                        @*<h3 class="form-section">活动模板基础信息</h3>*@
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="control-label col-md-3">活动名称</label>
                                    <div class="col-md-9">
                                        <div class="input-icon right">
                                            <i class="fa"></i>
                                            @Html.TextBoxFor(x => x.Name, new { @maxlength = "50", @class = "form-control" })
                                            @Html.HiddenFor(x => x.DataId)
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="control-label col-md-3">活动编码</label>
                                    <div class="col-md-9">
                                        <div class="input-icon right">
                                            <i class="fa"></i>
                                            @Html.TextBoxFor(x => x.Code, new { @maxlength = "50", @class = "form-control" })
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="control-label col-md-3">宣传图片</label>
                                    <div class="col-md-9">
                                        <div class="input-icon right">
                                            @*批量上传图片按钮*@
                                            <div id="btnalbum" style="float: left;" class="upload-box upload-album"></div>
                                            @*<input type="text" id="firstName" class="form-control" placeholder="Chee Kin">*@
                                            @Html.HiddenFor(x => x.Pictures)
                                            <div class="photo-list" style="float: left; width: 100%;">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="control-label col-md-3">活动类型</label>
                                    <div class="col-md-9">
                                        <div class="input-icon right">
                                            <i class="fa"></i>
                                            <select id="dllProjectType" class="form-control">
                                                <option value="@Model.ProjectTypeId">@(Model.ProjectTypeName ?? "请选择")</option>
                                            </select>
                                            @Html.HiddenFor(x => x.ProjectTypeId)
                                            @Html.HiddenFor(x => x.ProjectTypeName)
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="control-label col-md-3">活动地点</label>
                                    <div class="col-md-9">
                                        <div class="input-icon right">
                                            <i class="fa"></i>
                                            <select id="dllCountry" class="mt-radio form-control input-small">
                                                <option>@(Model.ProjectTemplatePlaceName == null ? "请选择" : Model.ProjectTemplatePlaceName.Split(",").Length >= 1 ? Model.ProjectTemplatePlaceName.Split(",")[0] : "")</option>
                                            </select>
                                            <select id="dllProvince" class="mt-radio form-control input-small">
                                                <option>@(Model.ProjectTemplatePlaceName == null ? "请选择" : Model.ProjectTemplatePlaceName.Split(",").Length >= 2 ? Model.ProjectTemplatePlaceName.Split(",")[1] : "")</option>
                                            </select>
                                            <select id="dllCity" class="mt-radio form-control input-small">
                                                <option value="@Model.ProjectTemplatePlaceLocationId">@(Model.ProjectTemplatePlaceName == null ? "请选择" : Model.ProjectTemplatePlaceName.Split(",").Length == 3 ? Model.ProjectTemplatePlaceName.Split(",")[2] : "")</option>
                                            </select>
                                            @Html.HiddenFor(x => x.ProjectTemplatePlaceLocationId)
                                            @Html.HiddenFor(x => x.ProjectTemplatePlaceName)
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="control-label col-md-3">主办方</label>
                                    <div class="col-md-9">
                                        <div class="input-icon right">
                                            <i class="fa"></i>
                                            @Html.TextBoxFor(x => x.Sponsor, new { @maxlength = "100", @class = "form-control" })
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="control-label col-md-3">推荐指数</label>
                                    <div class="col-md-9">
                                        <div class="input-icon right">
                                            <i class="fa"></i>
                                            <select id="dllRecommendedIndex" name="dllRecommendedIndex" class="form-control">
                                                <option value="1">1</option>
                                                <option value="2">2</option>
                                                <option value="3">3</option>
                                                <option value="4">4</option>
                                                <option value="5" selected="selected">5</option>
                                            </select>
                                            @Html.HiddenFor(x => x.RecommendedIndex)
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="control-label col-md-3">面向人群</label>
                                    <div class="col-md-9">
                                        <div class="input-icon right">
                                            <i class="fa"></i>
                                            <select id="dllSuitablePerson" name="dllSuitablePerson" class="form-control" style="display:none;">
                                                <option value="">--请选择--</option>
                                                <option value="1">亲子</option>
                                                <option value="2">小学</option>
                                                <option value="3">初中</option>
                                                <option value="4">高中</option>
                                                <option value="5">成人</option>
                                            </select>
                                            <select multiple id="dllFitGrade" name="dllFitGrade" class="form-control">
                                                <option value="7">小学一年级</option>
                                                <option value="8">小学二年级</option>
                                                <option value="9">小学三年级</option>
                                                <option value="10">小学四年级</option>
                                                <option value="11">小学五年级</option>
                                                <option value="12">小学六年级</option>
                                                <option value="13">初中一年级</option>
                                                <option value="14">初中二年级</option>
                                                <option value="15">初中三年级</option>
                                                <option value="16">高中一年级</option>
                                                <option value="17">高中二年级</option>
                                                <option value="18">高中三年级</option>
                                            </select>
                                            @Html.HiddenFor(x => x.SuitablePerson)
                                            @Html.HiddenFor(x => x.FitGrade)
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="control-label col-md-3">包含服务</label>
                                    <div class="col-md-9">
                                        <div class="input-icon right">
                                            <div class="mt-radio-inline">
                                                <label class="mt-checkbox">
                                                    <input type="checkbox" name="chkService" id="State1" value="住宿" checked> 住宿
                                                    <span></span>
                                                </label>
                                                <label class="mt-checkbox">
                                                    <input type="checkbox" name="chkService" id="State2" value="签证"> 签证
                                                    <span></span>
                                                </label>
                                                <label class="mt-checkbox">
                                                    <input type="checkbox" name="chkService" id="State3" value="保险"> 保险
                                                    <span></span>
                                                </label>
                                                @Html.HiddenFor(x => x.Service)
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="control-label col-md-3"></label>
                                    <div class="col-md-9">
                                        <div class="input-icon right">
                                            <i class="fa"></i>
                                            
                                            
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="control-label col-md-3">状态</label>
                                    <div class="col-md-9">
                                        <div class="input-icon right">
                                            <div class="mt-radio-inline">
                                                @if (Model.State == XZMY.Manage.Model.Enum.EState.禁用)
                                                {
                                                    <label class="mt-radio mt-radio-outline">
                                                        <input type="radio" name="State" value="1"> 启用
                                                        <span></span>
                                                    </label>
                                                    <label class="mt-radio mt-radio-outline">
                                                        <input type="radio" name="State" value="2" checked="checked"> 禁用
                                                        <span></span>
                                                    </label>
                                                }
                                                else
                                                {
                                                    <label class="mt-radio mt-radio-outline">
                                                        <input type="radio" name="State" value="1" checked="checked"> 启用
                                                        <span></span>
                                                    </label>
                                                    <label class="mt-radio mt-radio-outline">
                                                        <input type="radio" name="State" value="2"> 禁用
                                                        <span></span>
                                                    </label>
                                                }
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <h3 class="form-section">活动价格</h3>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="control-label col-md-3">市场价格</label>
                                    <div class="col-md-9">
                                        <div class="input-icon right">
                                            <i class="fa"></i>
                                            @Html.TextBoxFor(x => x.MarketPrice, new { @maxlength = "10", @class = "form-control" })
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="control-label col-md-3">活动价格</label>
                                    <div class="col-md-9">
                                        <div class="input-icon right">
                                            <i class="fa"></i>
                                            @Html.TextBoxFor(x => x.ActualPrice, new { @maxlength = "10", @class = "form-control" })
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="control-label col-md-3">折扣</label>
                                    <div class="col-md-9">
                                        <div class="input-icon right">
                                            <i class="fa"></i>
                                            @Html.TextBoxFor(x => x.Discount, new { @maxlength = "10", @class = "form-control" })
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="control-label col-md-3">定金</label>
                                    <div class="col-md-9">
                                        <div class="input-icon right">
                                            <i class="fa"></i>
                                            @Html.TextBoxFor(x => x.DepositPrice, new { @maxlength = "10", @class = "form-control" })
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <h3 class="form-section">活动分值</h3>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="control-label col-md-3">难度指数</label>
                                    <div class="col-md-9">
                                        <div class="input-icon right">
                                            <i class="fa"></i>
                                            <select id="dllDifficultyValue" name="dllDifficultyValue" class="form-control">
                                                <option value="1">1</option>
                                                <option value="2">2</option>
                                                <option value="3">3</option>
                                                <option value="4">4</option>
                                                <option value="5" selected="selected">5</option>
                                                <option value="6">6</option>
                                                <option value="7">7</option>
                                                <option value="8">8</option>
                                                <option value="9">9</option>
                                                <option value="10">10</option>
                                            </select>
                                            @Html.HiddenFor(x => x.DifficultyValue)
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6" style="display:none;">
                                <div class="form-group">
                                    <label class="control-label col-md-3">完成率</label>
                                    <div class="col-md-9">
                                        <div class="input-icon right">
                                            <i class="fa"></i>
                                            <select id="dllCompletionValue" name="dllCompletionValue" class="form-control">
                                                <option value="1">1</option>
                                                <option value="2">2</option>
                                                <option value="3">3</option>
                                                <option value="4">4</option>
                                                <option value="5" selected="selected">5</option>
                                                <option value="6">6</option>
                                                <option value="7">7</option>
                                                <option value="8">8</option>
                                                <option value="9">9</option>
                                                <option value="10">10</option>
                                            </select>
                                            @Html.HiddenFor(x => x.CompletionValue)
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="control-label col-md-3">性价比</label>
                                    <div class="col-md-9">
                                        <div class="input-icon right">
                                            <i class="fa"></i>
                                            <select id="dllFeeValue" name="dllFeeValue" class="form-control">
                                                <option value="1">1</option>
                                                <option value="2">2</option>
                                                <option value="3">3</option>
                                                <option value="4">4</option>
                                                <option value="5" selected="selected">5</option>
                                                <option value="6">6</option>
                                                <option value="7">7</option>
                                                <option value="8">8</option>
                                                <option value="9">9</option>
                                                <option value="10">10</option>
                                            </select>
                                            @Html.HiddenFor(x => x.FeeValue)
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <h3 class="form-section">成长分值</h3>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="control-label col-md-3">英语加分</label>
                                    <div class="col-md-9">
                                        <div class="input-icon right">
                                            <i class="fa"></i>
                                            <input id="EnglishScore" name="EnglishScore" maxlength="10" class="form-control" value="0" disabled="disabled" onkeyup = "inputFloat(this)" />
                                            
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="control-label col-md-3">学科加分</label>
                                    <div class="col-md-9">
                                        <div class="input-icon right">
                                            <i class="fa"></i>
                                            <input id="LearnScore" name="LearnScore" maxlength="10" class="form-control" value="0" disabled="disabled" onkeyup = "inputFloat(this)" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="control-label col-md-3">素质加分</label>
                                    <div class="col-md-9">
                                        <div class="input-icon right">
                                            <i class="fa"></i>
                                            <input id="QualityScore" name="QualityScore" maxlength="10" class="form-control" value="@(Model.QualityScore.ToString("#0.00"))"  onkeyup="inputFloat(this)" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <h3 class="form-section">历练项目</h3>
                        @{
                            ScoreItemsController bllScoreItems = new ScoreItemsController();
                            var listScoreItems = bllScoreItems.GetListScoreItems(3);
                        }
                        <div id="divScoreItems">
                            <input id="ScoreItemCount" name="ScoreItemCount" type="hidden" value="@(listScoreItems.Count)" />
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="control-label col-md-3">主要成长</label>
                                        <div class="col-md-9">
                                            <div class="input-icon right">
                                                <div id="divScoreItemNames" class="controls mt-radio-inline" style="width: 100%;">
                                                    @foreach (var m in listScoreItems)
                                                    {
                                                        Model.ScoreItemNames = Model.ScoreItemNames ?? "";
                                                        if (Model.ScoreItemNames.IndexOf(m.Name) >= 0)
                                                        { <label class="mt-checkbox">
                                                                <input type="checkbox" class="ckScoreItemNames" name="ckScoreItemNames" value="@(m.Name)" checked="checked">@(m.Name)<span></span>
                                                            </label>
                                                        }
                                                        else
                                                        {
                                                            <label class="mt-checkbox">
                                                                <input type="checkbox" class="ckScoreItemNames" name="ckScoreItemNames" value="@(m.Name)">@(m.Name)<span></span>
                                                            </label>
                                                        }
                                                    }
                                                    @Html.HiddenFor(x => x.ScoreItemNames)
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <input id="ScoreItemValueList" name="ScoreItemValueList" type="hidden" value="" />
                            @{
                                ScoresController bllScores = new ScoresController();
                                var listScores = bllScores.GetListSourceID(Model.DataId);
                                foreach (var m in listScoreItems)
                                {
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="control-label col-md-3" for="InsertDivScoreItemsNo">@(m.Name)</label>
                                                <div class="col-md-9">
                                                    <div class="input-icon right">
                                                        <div class="controls mt-radio-inline" style="width: 100%;">
                                                            @{
                                                                bool bScores = false;
                                                                Decimal ModelScoreValue = 0M;
                                                                Guid ModelScoreItemsId = m.Id;
                                                                String ScoreItemsName = m.Name;
                                                                Guid ScoresId = Guid.Empty;
                                                            }
                                                            @foreach (var n in listScores)
                                                            {
                                                                if (m.Id == n.ScoreItemsId)
                                                                {
                                                                    bScores = true;
                                                                    ModelScoreValue = n.ScoreValue;
                                                                    ModelScoreItemsId = m.Id;
                                                                    ScoreItemsName = m.Name;
                                                                    ScoresId = n.Id;
                                                                    break;
                                                                }
                                                            }
                                                            <input name="txtScoreValue" type="text" autocomplete="off" value="@(ModelScoreValue.ToString("#0.00"))" ScoreItemsId="@(ModelScoreItemsId)" ScoreItemsName="@(ScoreItemsName)" ScoresId="@(ScoresId)" onkeyup="inputFloatOnClick(this)" class="txtScoreItem form-control">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                                                }
                            }
                        </div>
                        <h3 class="form-section">活动介绍</h3>

                        <div class="tab-pane active" id="tab_4">
                            <div class="portlet box blue">
                                @*<div class="portlet-title">
                                        <div class="caption">
                                            <i class="icon-reorder"></i>活动介绍
                                        </div>
                                        <div class="tools">
                                            <a href="javascript:void(0);" class="collapse"></a>
                                        </div>
                                    </div>*@
                                <div class="portlet-body form">
                                    <div class="row-fluid">
                                        <div class="span11 ">
                                            <div class="control-group">
                                                @*<label class="control-label" for="RealName">活动介绍<span class="required">*</span></label>*@
                                                <div class="controls">
                                                    <ul class="nav nav-tabs">
                                                        <li class="active"><a href="#tab_1_1" data-toggle="tab">项目介绍</a></li>
                                                        <li><a href="#tab_1_2" data-toggle="tab">行程安排</a></li>
                                                        <li><a href="#tab_1_3" data-toggle="tab">费用说明</a></li>
                                                        <li><a href="#tab_1_4" data-toggle="tab">住宿安排</a></li>
                                                        <li><a href="#tab_1_5" data-toggle="tab">签证说明</a></li>
                                                        <li><a href="#tab_1_6" data-toggle="tab">行程须知</a></li>
                                                        <li><a href="#tab_1_7" data-toggle="tab">安全保障</a></li>
                                                    </ul>
                                                    <div class="tab-content">
                                                        <div class="tab-pane active" id="tab_1_1">
                                                            <script id="editorProjectTemplateDescription" type="text/plain" style="width: 99%; height: 300px;">
                                                                @Html.Raw(Model.ProjectTemplateDescription)
                                                            </script>
                                                            @Html.HiddenFor(x => x.ProjectTemplateDescription)
                                                        </div>
                                                        <div class="tab-pane" id="tab_1_2">
                                                            <script id="editorSchedule" type="text/plain" style="width: 99%; height: 300px;">
                                                                @Html.Raw(Model.Schedule)
                                                            </script>
                                                            @Html.HiddenFor(x => x.Schedule)
                                                        </div>
                                                        <div class="tab-pane" id="tab_1_3">
                                                            <script id="editorFee" type="text/plain" style="width: 99%; height: 300px;">
                                                                @Html.Raw(Model.Fee)
                                                            </script>
                                                            @Html.HiddenFor(x => x.Fee)
                                                        </div>
                                                        <div class="tab-pane" id="tab_1_4">
                                                            <script id="editorStay" type="text/plain" style="width: 99%; height: 300px;">
                                                                @Html.Raw(Model.Stay)
                                                            </script>
                                                            @Html.HiddenFor(x => x.Stay)
                                                        </div>
                                                        <div class="tab-pane" id="tab_1_5">
                                                            <script id="editorVisa" type="text/plain" style="width: 99%; height: 300px;">
                                                                @Html.Raw(Model.Visa)
                                                            </script>
                                                            @Html.HiddenFor(x => x.Visa)
                                                        </div>
                                                        <div class="tab-pane" id="tab_1_6">
                                                            <script id="editorStroke" type="text/plain" style="width: 99%; height: 300px;">
                                                                @Html.Raw(Model.Stroke)
                                                            </script>
                                                            @Html.HiddenFor(x => x.Stroke)
                                                        </div>
                                                        <div class="tab-pane" id="tab_1_7">
                                                            <script id="editorSecurity" type="text/plain" style="width: 99%; height: 300px;">
                                                                @Html.Raw(Model.Security)
                                                            </script>
                                                            @Html.HiddenFor(x => x.Security)
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-actions">
                        <div class="row">
                            <div class="col-md-offset-3 col-md-9">
                                <button type="submit" class="btn green">保存</button>
                                <button type="reset" class="btn default">重置</button>
                            </div>
                        </div>
                    </div>
                </form>
                <div id="score-item" class="row" style="display: none">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="control-label col-md-3" for="txtScoreValue__INDEX_____Id__">__NAME__</label>
                            <div class="col-md-9">
                                <div class="input-icon right">
                                    <i class="fa"></i>
                                    <input type="text" id="txtScoreValue__INDEX_____Id__" name="txtScoreValue__INDEX__" value="0" onkeyup="inputFloatOnClick(this)" maxlength="7" class="form-control">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- END FORM-->
            </div>
        </div>
        <!-- END VALIDATION STATES-->
    </div>
</div>
@section JavaScript{
    <script type="text/javascript" src="/UploadCode/webuploader/webuploader.min.js"></script>
    <script type="text/javascript" charset="utf-8" src="/UploadCode/js/uploader.js"></script>

    <script type="text/javascript" charset="utf-8" src="/Content/Custom/UEditor/ueditor.config.js"></script>
    <script type="text/javascript" charset="utf-8" src="/Content/Custom/UEditor/ueditor.all.min.js"> </script>
    <script type="text/javascript" charset="utf-8" src="/Content/Custom/UEditor/lang/zh-cn/zh-cn.js"></script>
    <script type="text/javascript" src="~/Content/Metronic/js/jquery.inputmask.bundle.min.js"></script>
    <script type="text/javascript">
        ///保存到页面的分值控件
        var SaveScoreItemValueList = function () {
            var strValue = '';
            $('.txtScoreItem').each(function (k, v) {
                strValue += $(v).attr("ScoresId") + ',' + parseFloat($(v).val()) + ',' + $(v).attr("ScoreItemsId") + ',' + $(v).attr("ScoreItemsName") + '|';
            });
            $("#ScoreItemValueList").val(strValue);
        }
        $(function () {
            //页面加载绑定各种下拉列表框
            LoadPage();
            //添加上传图片按钮
            $("#btnalbum").InitUploader({
                btntext: "批量上传",
                multiple: true,
                water: false,
                thumbnail: false,
                NoUrl: true,
                sendurl: "/UploadCode/ajax.ashx",
            });
            //var value;//= prompt('插入html代码', '');
            //value = $("#ProjectTemplateDescription").val();
            //alert(value);
            //UE.getEditor('editorProjectTemplateDescription').execCommand('insertHtml', value);
            //alert(value);
        });


        function LoadPage() {
            $("#dllSuitablePerson").val($("#SuitablePerson").val());
            LoadDllScore();
            LoadPrice();
            LoadService();
            //加载活动图片
            ShowImageList();
            //活动模板类型下拉列表框
            BingdllProjectTemplateType();
            //加载地区
            GetCountry($("#ProjectTemplatePlaceName").val());

            //推荐年级赋值
            $("#dllFitGrade").val([@(Model.SuitablePerson??"")]);

            //成长分值设置为两位小数
            if ($("#EnglishScore").val() == "") {
                $("#EnglishScore").val(0);
            } else {
                $("#EnglishScore").val(parseFloat($("#EnglishScore").val()).toFixed(2));
            }
            if ($("#LearnScore").val() == "") {
                $("#LearnScore").val(0);
            } else {
                $("#LearnScore").val(parseFloat($("#LearnScore").val()).toFixed(2));
            }
            if ($("#QualityScore").val() == "") {
                $("#QualityScore").val(0);
            } else {
                $("#QualityScore").val(parseFloat($("#QualityScore").val()).toFixed(2));
            }
        }
        //页面加载绑定活动分值
        function LoadDllScore() {
            //DifficultyValue 难度系数
            $("#dllDifficultyValue").change(function () {
                $("#DifficultyValue").val($("#dllDifficultyValue").val());
            });
            if ($("#DifficultyValue").val() != "0") {
                $("#dllDifficultyValue").val($("#DifficultyValue").val());
            }

            //CompletionValue 完成系数
            $("#dllCompletionValue").change(function () {
                $("#CompletionValue").val($("#dllCompletionValue").val());
            });
            if ($("#CompletionValue").val() != "0") {
                $("#dllCompletionValue").val($("#CompletionValue").val());
            }

            //FeeValue 性价比
            $("#dllFeeValue").change(function () {
                $("#FeeValue").val($("#dllFeeValue").val());
            });
            if ($("#FeeValue").val() != "0") {
                $("#dllFeeValue").val($("#FeeValue").val());
            }

            //RecommendedIndex 推荐指数  1~5
            $("#dllRecommendedIndex").change(function () {
                $("#RecommendedIndex").val($("#dllRecommendedIndex").val());
            });
            if ($("#RecommendedIndex").val() != "0") {
                $("#dllRecommendedIndex").val($("#RecommendedIndex").val());
            }

            var id = $("#Id").val();
            //加载分值项目
            if (id != "00000000-0000-0000-0000-000000000000") {
                //修改
                $.getJSON("/Scores/AjaxList", { SourceId: id },
                   function (data) {
                       $.each(data.rows, function (i, item) {
                           //ScoresId,ScoreItemsId,ScoreItemName,SourceId,SourceType,ScoreValue
                           InsertDivScoreItems(item["Id"], item["ScoreItemsId"], item["ScoreItemsName"], id, 'ProjectTemplate', item.ScoreValue, i);
                       });
                   });

            }
            else {
                //新增
                $.getJSON("/ScoreItems/AjaxList3", { Type: 3 },
                   function (data) {
                       $.each(data.rows, function (i, item) {
                           //ScoresId,ScoreItemsId,ScoreItemName,SourceId,SourceType,Score
                           InsertDivScoreItems('00000000-0000-0000-0000-000000000000', item["Id"], item["Name"], '00000000-0000-0000-0000-000000000000', 'ProjectTemplate', 0,i);
                       });
                   });
            }

        }
        var scoreItem = $('#score-item');
        var InsertDivScoreItemsNo = 0;
        //
        var InsertDivScoreItems = function (ScoresId, ScoreItemsId, ScoreItemName, SourceId, SourceType, ScoreValue, i) {
            if (ScoreValue == undefined) { ScoreScoreValue = 0; }
            //if (!isNaN(ScoreValue)) { ScoreValue = 0; }
            InsertDivScoreItemsNo++;
            var divname = [];
            //+ '     <div class="row-fluid">                                                                                       '
            //+ '          <div class="span6 ">                                                                                     '
            //+ '              <div class="control-group">                                                                          '
            //+ '                  <label class="control-label" for="RealName">' + ScoreItemName + '</label>      '
            //+ '                  <div class="controls">                                                                           '
            //+ '                        <input id="InsertDivScoreItemsNo' + InsertDivScoreItemsNo + '" type="text"  value="' + Score + '"   ScoreItemsId="' + ScoreItemsId + '" ScoreItemsName="' + ScoreItemName + '" ScoresId="' + ScoresId + '"  class="txtScoreItem m-wrap span10" placeholder="Chee Kin">          '
            //+ '                  </div>                                                                                           '
            //+ '              </div>                                                                                               '
            //+ '          </div>                                                                                                   '
            //+ '      </div>                                                                                                       '
            //var flag = i % 2 == 0;
            //console.log(i + ' - ' + flag);
            //if (flag ) {
            //    divname.push('            <div class="row">');
            ////}
            //divname.push('                <div class="col-md-6">');
            //divname.push('                    <div class="form-group">');
            //divname.push('                        <label class="control-label col-md-3">' + ScoreItemName + '</label>');
            //divname.push('                        <div class="col-md-9">');
            //divname.push('                            <div class="input-icon right">');
            //divname.push('                                <div id="divScoreItemNames" class="controls mt-radio-inline" style="width: 100%;">');
            //divname.push('                                     <input id="InsertDivScoreItemsNo' + InsertDivScoreItemsNo + '" name="txtScoreValue" type="text"  value="' + ScoreValue + '"  ScoreItemsId="' + ScoreItemsId + '" ScoreItemsName="' + ScoreItemName + '" ScoresId="' + ScoresId + '" onkeyup="inputFloatOnClick(this)" class="txtScoreItem form-control">          ');
            //divname.push('                                </div>');
            //divname.push('                            </div>');
            //divname.push('                        </div>');
            //divname.push('                    </div>');
            //divname.push('                </div>');

            ////if (!flag) {
            //    divname.push('            </div>');
            ////}



            //$(divname.join('')).appendTo($("#divScoreItems"));
            //$(".txtScoreItem").inputmask({ "mask": "9", "repeat": 10, "greedy": false });  // ~ mask "9" or mask "99" or ... mask "9999999999"

            //添加成长项目
            //var vScoreItemNames = new Array();
            //vScoreItemNames.push('<label class="mt-checkbox">');
            //if ($("#ScoreItemNames").val().indexOf(ScoreItemName) >= 0) {
            //    vScoreItemNames.push('       <input type="checkbox" name="ckScoreItemNames" value="' + ScoreItemName + '" checked> ' + ScoreItemName + '<span></span>');
            //    //'                         <input class="ckScoreItemNames" type="checkbox" value="' + ScoreItemName + '" checked="checked"/> ' + ScoreItemName
            //} else {
            //    //vScoreItemNames.push('    <input class="ckScoreItemNames" type="checkbox" value="' + ScoreItemName + '" /> ' + ScoreItemName);
            //    vScoreItemNames.push('       <input type="checkbox" name="ckScoreItemNames" value="' + ScoreItemName + '"> ' + ScoreItemName + '<span></span>');
            //}
            //vScoreItemNames.push('</div>');
            //$(vScoreItemNames.join('')).appendTo($("#divScoreItemNames"));
        };
        var inputFloatOnClick = function (obj) {
            inputFloat(obj);
            var mScore = 0;
            $('.txtScoreItem').each(function (k, v) {
                mScore += parseFloat($(v).val());
            });
            $("#QualityScore").val(parseFloat(parseFloat(mScore) / parseFloat($("#ScoreItemCount").val())).toFixed(2));
        }
        //价格
        function LoadPrice() {
            $("#MarketPrice").inputmask('decimal', { rightAlignNumerics: false }); //disables the right alignment of the decimal input
            $("#ActualPrice").inputmask('decimal', { rightAlignNumerics: false }); //disables the right alignment of the decimal input
            $("#Discount").inputmask('decimal', { rightAlignNumerics: false }); //disables the right alignment of the decimal input
            $("#DepositPrice").inputmask('decimal', { rightAlignNumerics: false }); //disables the right alignment of the decimal input

            $('#MarketPrice').keyup(function () {

            });
            $('#ActualPrice').keyup(function () {
                if ($('#MarketPrice').val() > 0) {
                    var aDiscount = $('#ActualPrice').val() / $('#MarketPrice').val();
                    $('#Discount').val(aDiscount.toFixed(2));
                }
            });
            $('#Discount').keyup(function () {
                if ($('#MarketPrice').val() > 0) {
                    var aActualPrice = $('#MarketPrice').val() * $('#Discount').val()
                    $('#ActualPrice').val(aActualPrice.toFixed(2));
                }
            });

        }
        //包含服务
        function LoadService() {
            var strService = $("#Service").val();
            $('.chkService').each(function (k, v) {
                if (strService.indexOf($(v).val()) >= 0) {
                    $(v).attr('checked', 'checked');
                }
            });
        }
        //绑定活动模板类型
        function BingdllProjectTemplateType() {
            //绑定控件
            $("#dllProjectType").empty();
            $.getJSON("/Content/Custom/DataDictionary.ashx", { action: "GetGetCatagory", Key: "ProjectType" }, function (data) {
                appendOption(data.ProjectType, '#dllProjectType');
                if ($("#ProjectTypeId").val() != "00000000-0000-0000-0000-000000000000") {
                    $("#dllProjectType").val($("#ProjectTypeId").val());
                } else {
                    $("#dllProjectType").val("bda3e825-31fc-4c9d-af06-b010b40eef13");
                }
            });
            //加载事件
            $("#dllProjectType").change(function () {
                $("#ProjectTypeId").val($("#dllProjectType").val());
                $("#ProjectTypeName").val($("#dllProjectType").find("option:selected").text());
            });
        }
        //绑定地区国家信息
        function GetCountry(LocationName) {
            //加载事件
            $("#dllCountry").change(function () {
                $("#ProjectTemplatePlaceLocationId").val($("#dllCountry").val());
                $("#ProjectTemplatePlaceName").val($("#dllCountry").find("option:selected").text());
                GetProvince("");
                GetCity("");
            });

            var lName = LocationName.split(',');
            var CountryName = "";
            if (lName.length > 0) {
                CountryName = lName[0];
            }
            $.ajaxSettings.async = false;
            $.getJSON("/Content/Custom/Location.ashx",
                { action: "GetLocationLevel", Level: 1 },
                function (data) {
                    $("#dllCountry").empty();
                    $.each(data, function(i, item) {
                        if (item["Name"] != CountryName) {
                            $("<option></option>").val(item["Id"]).text(item["Name"]).appendTo($("#dllCountry"));
                        } else {
                            $("<option selected='selected'></option>").val(item["Id"]).text(item["Name"]).appendTo($("#dllCountry"));
                        }
                    });

                    if ($("#dllCountry").val() != null) {
                        $("#ProjectTemplatePlaceLocationId").val($("#dllCountry").val());
                        $("#ProjectTemplatePlaceName").val($("#dllCountry").find("option:selected").text());
                        GetProvince(LocationName);
                    }
                });
        }
        //绑定地区省份信息
        function GetProvince(LocationName) {
            //加载事件
            $("#dllProvince").change(function () {
                $("#ProjectTemplatePlaceLocationId").val($("#dllProvince").val());
                $("#ProjectTemplatePlaceName").val($("#dllCountry").find("option:selected").text() + "," + $("#dllProvince").find("option:selected").text());
                GetCity("");
            });

            var lName = LocationName.split(',');
            var ProvinceName = "";
            if (lName.length > 1) {
                ProvinceName = lName[1];
            }
            if ($("#dllCountry").val() != null) {
                $.ajaxSettings.async = false;
                $.getJSON(
                    "/Content/Custom/Location.ashx",
                    { action: "GetLocationParentId", ParentId: $("#dllCountry").val() },

                    function (data) {
                        $("#dllProvince").empty();
                        $.each(data, function(i, item) {
                            if (item["Name"] != ProvinceName) {
                                $("<option></option>").val(item["Id"]).text(item["Name"]).appendTo($("#dllProvince"));
                            } else {
                                $("<option selected='selected'></option>").val(item["Id"]).text(item["Name"]).appendTo($("#dllProvince"));
                            }
                        });

                        if ($("#dllProvince").val() != null) {
                            $("#ProjectTemplatePlaceLocationId").val($("#dllProvince").val());
                            $("#ProjectTemplatePlaceName").val($("#dllCountry").find("option:selected").text() + "," + $("#dllProvince").find("option:selected").text());
                            GetCity(LocationName);
                        }
                        else {
                            $("#dllCity").empty();
                        }
                    });
            }
        }
        //绑定地区城市信息
        function GetCity(LocationName) {
            //加载事件
            $("#dllCity").change(function () {
                $("#ProjectTemplatePlaceLocationId").val($("#dllCity").val());
                $("#ProjectTemplatePlaceName").val($("#dllCountry").find("option:selected").text() + "," + $("#dllProvince").find("option:selected").text() + "," + $("#dllCity").find("option:selected").text());
            });

            var lName = LocationName.split(',');
            var CityName = "";
            if (lName.length > 2) {
                CityName = lName[2];
            }
            if ($("#dllProvince").val() != null) {
                $.ajaxSettings.async = false;
                $.getJSON("/Content/Custom/Location.ashx",
                    { action: "GetLocationParentId", ParentId: $("#dllProvince").val() },
                    function (data) {
                        $("#dllCity").empty();
                        $.each(data, function(i, item) {
                            if (item["Name"] != CityName) {
                                $("<option></option>").val(item["Id"]).text(item["Name"]).appendTo($("#dllCity"));
                            } else {
                                $("<option selected='selected'></option>").val(item["Id"]).text(item["Name"]).appendTo($("#dllCity"));
                            }
                        });
                        if ($("#dllCity").val() != null) {
                            $("#ProjectTemplatePlaceLocationId").val($("#dllCity").val());
                            $("#ProjectTemplatePlaceName").val($("#dllCountry").find("option:selected").text() + "," + $("#dllProvince").find("option:selected").text() + "," + $("#dllCity").find("option:selected").text());
                        }
                    });
            }
            else {
                $("#dllCity").empty();
            }
        }
        //显示图片
        function ShowImageList() {
            if ($("#Pictures").val() != "") {
                var ImageUrls = $("#Pictures").val().split(",");
                for (var i = 0; i < ImageUrls.length; i++) {
                    ShowImageNoUrl(ImageUrls[i]);
                }
            }
        }

        //页面保存
        function SavePage() {
            //SavePagedivScoreItemNames();//保存历练项目主要成长项目名称
            //保存多张图片
            seturlimage();
            SavePageService();
            SavePageSuitablePerson();
            setTextArea();
            SaveScoreItemValueList();
        }
        ///保存历练项目主要成长项目名称
        //var SavePagedivScoreItemNames = function () {
        //    var strNames = [];
        //    $('.ckScoreItemNames').each(function (k, v) {
        //        if ($(v).attr('checked') == 'checked') {
        //            strNames.push($(v).val());
        //        }
        //    });
        //    $("#ScoreItemNames").val(strNames.join(','));
        //};
        //保存包含服务
        function SavePageService() {
            var strService = [];
            $('.chkService').each(function (k, v) {
                if ($(v).attr('checked') == 'checked') {
                    strService.push($(v).val());
                }
            });
            $('#Service').val(strService.join(','));
        }
        //面向人群
        function SavePageSuitablePerson() {
            $('#SuitablePerson').val($('#dllSuitablePerson').val());
        }
        //保存批量图片入文本框控件中
        function seturlimage() {
            var strUrl = '';
            var strImageUrl = '';
            for (var i = 0; i < document.getElementsByName("hid_photo_ImageUrl").length; i++) {
                if (document.getElementsByName("hid_photo_ImageUrl").length == i + 1) {
                    strImageUrl += document.getElementsByName("hid_photo_ImageUrl")[i].value;
                } else {
                    strImageUrl += document.getElementsByName("hid_photo_ImageUrl")[i].value + ',';
                }
            }
            //$('#Url').val(strUrl);
            $('#Pictures').val(strImageUrl);

        }

        jQuery(document).ready(function () {
            var form1 = $('#defaultForm');
            var error1 = $('.alert-error', form1);
            var success1 = $('.alert-success', form1);

            form1.validate({
                errorElement: 'span', //default input error message container
                errorClass: 'help-block help-block-error', // default input error message class
                focusInvalid: false, // do not focus the last invalid input
                ignore: "",
                rules: {
                    Name: { minlength: 1, required: true }
                },

                //invalidHandler: function (event, validator) { //display error alert on form submit
                //    success1.hide();
                //    error1.show();
                //    App.scrollTo(error1, -200);
                //},

                errorPlacement: function (error, element) { // render error placement for each input type
                    var icon = $(element).parent('.input-icon').children('i');
                    icon.removeClass('fa-check').addClass("fa-warning");
                    icon.attr("data-original-title", error.text()).tooltip({ 'container': 'body' });
                },

                highlight: function (element) { // hightlight error inputs
                    $(element).closest('.form-group').removeClass("has-success").addClass('has-error'); // set error class to the control group
                },

                unhighlight: function (element) { // revert the change done by hightlight

                },

                success: function (label, element) {
                    var icon = $(element).parent('.input-icon').children('i');
                    $(element).closest('.form-group').removeClass('has-error').addClass('has-success'); // set success class to the control group
                    icon.removeClass("fa-warning").addClass("fa-check");
                },

                submitHandler: function (form) {
                    //success1.show();
                    //error1.hide();
                    //form1.submit();
                    SavePage();




                    var data = form1.serializeObject();
                    console.log(JSON.stringify(data));

                    $.ajax({
                        type: 'POST',
                        url: '/ProjectTemplate/AjaxEdit',
                        data: data,
                        dataType: 'JSON',
                        success: function (result) {
                            //redata = result;
                            //$('.txtScoreItem').each(function (k, v) {
                            //    var scoreModel = {
                            //        Id: $(v).attr("ScoresId"),
                            //        ScoreItemsId: $(v).attr("ScoreItemsId"),
                            //        ScoreItemsName: $(v).attr("ScoreItemsName"),
                            //        SourceId: result.Id,
                            //        SourceType: "ProjectTemplate",
                            //        ScoreValue: $(v).val()
                            //    };
                            //    //保存完成后保存 分值
                            //    //var strurl = '';
                            //    //if ($("#Id").val() != "00000000-0000-0000-0000-000000000000") {
                            //    //    //修改
                            //    //    strurl = '/Content/Custom/SiteSetting.ashx?action=AddScores&ScoreItemsId=' + $(v).attr("ScoreItemsId") + '&ScoreItemsName=' + $(v).attr("ScoreItemsName") + '&SourceId=' + result.Id + '&SourceType=3&Source=' + $(v).val() + '&Id=' + $(v).attr("ScoresId");
                            //    //} else {
                            //    //    //新增
                            //    //    strurl='/Content/Custom/SiteSetting.ashx?action=AddScores&ScoreItemsId=' + $(v).attr("ScoreItemsId") + '&ScoreItemsName=' + $(v).attr("ScoreItemsName") + '&SourceId=' + result.Id + '&SourceType=3&Source=' + $(v).val();
                            //    //}
                            //    $.ajax({
                            //        url: "/Scores/AjaxEdit",
                            //        data: scoreModel,
                            //        type: 'post',
                            //        async: false, //默认为true 异步
                            //        error: function () { alert('error'); },
                            //        success: function (data) { }
                            //    });
                            //});
                            if (result.success)
                                location.replace('/ProjectTemplate/Edit/' + result.Id);
                            else {
                                showToast(3, '系统消息', result.message);//错误信息
                            }
                        },
                        error: function (XMLHttpRequest, textStatus, errorThrown) {
                            showToast(3, '系统消息', JSON.stringify(errorThrown));//错误信息
                            //LigerEP.ShowMsg('error', '网络错误！即将重新登录！');
                            //window.location.replace("/MCustoms/Login");
                        },
                        async: false
                    });
                }
            });
        });





    </script>
    <script type="text/javascript">
        window.onload = function () {
            var ue = UE.getEditor('editorProjectTemplateDescription');
            ue = UE.getEditor('editorSchedule');
            ue = UE.getEditor('editorFee');
            ue = UE.getEditor('editorStay');
            ue = UE.getEditor('editorVisa');
            ue = UE.getEditor('editorStroke');
            ue = UE.getEditor('editorSecurity');

        }

        var setTextArea = function () {
            $("#ProjectTemplateDescription").val(UE.getEditor('editorProjectTemplateDescription').getContent());
            $("#Schedule").val(UE.getEditor('editorSchedule').getContent());
            $("#Fee").val(UE.getEditor('editorFee').getContent());
            $("#Stay").val(UE.getEditor('editorStay').getContent());
            $("#Visa").val(UE.getEditor('editorVisa').getContent());
            $("#Stroke").val(UE.getEditor('editorStroke').getContent());
            $("#Security").val(UE.getEditor('editorSecurity').getContent());
        }
    </script>
}
